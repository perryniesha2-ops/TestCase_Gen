<!DOCTYPE html>
<html>
<head>
    <title>Extension Debug Test</title>
</head>
<body>
    <h1>Extension Debug Test</h1>
    <button onclick="testExtension()">Test Extension</button>
    <button onclick="testStorage()">Test Storage</button>
    <pre id="log"></pre>

    <script>
        function log(msg) {
            const el = document.getElementById('log');
            el.textContent += new Date().toISOString() + ': ' + msg + '\n';
            console.log(msg);
        }

        // Check if extension is loaded
        log('Checking extension...');
        log('__QA_EXTENSION_INSTALLED: ' + window.__QA_EXTENSION_INSTALLED);

        function testExtension() {
            log('Testing extension communication...');
            
            // Send test message
            window.postMessage({
                type: 'QA_TEST_MESSAGE',
                data: 'Hello from page'
            }, '*');
            
            log('Sent QA_TEST_MESSAGE');
        }

        function testStorage() {
            log('Testing storage...');
            
            // Try to set storage
            window.postMessage({
                type: 'QA_STORAGE_SET',
                key: 'test_key',
                value: { test: 'value', time: Date.now() }
            }, '*');
            
            log('Sent QA_STORAGE_SET');
            
            // Check storage after 1 second
            setTimeout(() => {
                window.postMessage({
                    type: 'QA_CHECK_STORAGE',
                    key: 'test_key'
                }, '*');
                log('Sent QA_CHECK_STORAGE');
            }, 1000);
        }

        // Listen for responses
        window.addEventListener('message', (event) => {
            if (event.source !== window) return;
            if (event.data.type && event.data.type.startsWith('QA_')) {
                log('Received: ' + event.data.type + ' - ' + JSON.stringify(event.data));
            }
        });

        log('Debug page ready');
    </script>
</body>
</html>